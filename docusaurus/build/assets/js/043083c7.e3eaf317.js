"use strict";(self.webpackChunkbobadocs=self.webpackChunkbobadocs||[]).push([[6095],{5318:(e,t,n)=>{n.d(t,{Zo:()=>l,kt:()=>h});var a=n(7378);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,s=function(e,t){if(null==e)return{};var n,a,s={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var c=a.createContext({}),d=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},l=function(e){var t=d(e.components);return a.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,s=e.mdxType,r=e.originalType,c=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),u=d(n),h=s,g=u["".concat(c,".").concat(h)]||u[h]||p[h]||r;return n?a.createElement(g,o(o({ref:t},l),{},{components:n})):a.createElement(g,o({ref:t},l))}));function h(e,t){var n=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var r=n.length,o=new Array(r);o[0]=u;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:s,o[1]=i;for(var d=2;d<r;d++)o[d]=n[d];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},5606:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>d});var a=n(5773),s=(n(7378),n(5318));const r={sidebar_position:3},o="How to test endpoints",i={unversionedId:"engineering/boba-backend/APIs/testing-endpoints",id:"engineering/boba-backend/APIs/testing-endpoints",title:"How to test endpoints",description:"This document defines how to write tests for BobaBoard's REST API endpoints.",source:"@site/docs/engineering/boba-backend/APIs/testing-endpoints.md",sourceDirName:"engineering/boba-backend/APIs",slug:"/engineering/boba-backend/APIs/testing-endpoints",permalink:"/docs/engineering/boba-backend/APIs/testing-endpoints",draft:!1,editUrl:"https://github.com/essential-randomness/bobadocs/edit/main/docs/engineering/boba-backend/APIs/testing-endpoints.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"engineering",previous:{title:"How to work with endpoints",permalink:"/docs/engineering/boba-backend/APIs/creating-endpoints"},next:{title:"API guidelines",permalink:"/docs/engineering/boba-backend/APIs/API-guidelines"}},c={},d=[{value:"What are tests",id:"what-are-tests",level:2},{value:"API testing",id:"api-testing",level:2},{value:"Test cases",id:"test-cases",level:3},{value:"Mocking",id:"mocking",level:3},{value:"Testing BobaBackend&#39;s API Routes",id:"testing-bobabackends-api-routes",level:2}],l={toc:d};function p(e){let{components:t,...n}=e;return(0,s.kt)("wrapper",(0,a.Z)({},l,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"how-to-test-endpoints"},"How to test endpoints"),(0,s.kt)("p",null,"This document defines how to write tests for BobaBoard's REST API endpoints."),(0,s.kt)("h2",{id:"what-are-tests"},"What are tests"),(0,s.kt)("p",null,"Tests ensures that software does what it's supposed to do. They can be used both to find new bugs and to avoid the accidental reintroduction of previously-known ones."),(0,s.kt)("p",null,"Tests are a fundamental part of creating stable, robust software, and their importance only increases as the project itself grows. Having good test coverage\u2014that is, ensuring that a significant percentage of code is checked as part of the testing process\u2014allows developers to create new features confidently, and reduces the amount of bugs that reach the end users. It also allows developer to make fundamental architectural changes without causing a ",(0,s.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Software_regression"},"regression")," (i.e. breakage) in functionality."),(0,s.kt)("h2",{id:"api-testing"},"API testing"),(0,s.kt)("p",null,"While many ",(0,s.kt)("a",{parentName:"p",href:"https://educative.io/blog/software-testing-types-101#functional-methods"},"different types of tests")," exists, APIs are usually tested through integration tests. Integration tests ensure that multiple components (e.g. database, server) work together as expected. In the case of BobaBoard's API routes, integration tests cover the database and the server, with authentication and caching being instead ",(0,s.kt)("a",{parentName:"p",href:"#mocking"},"mocked"),"."),(0,s.kt)("h3",{id:"test-cases"},"Test cases"),(0,s.kt)("p",null,"Tests are divided in test cases. Each test case represents a set of actions that verify that a single behavior of the software under test is working as intended. For example, a test case might verify that a ",(0,s.kt)("inlineCode",{parentName:"p"},"GET")," request to the ",(0,s.kt)("inlineCode",{parentName:"p"},"/users/@me/")," endpoint returns a ",(0,s.kt)("inlineCode",{parentName:"p"},"401")," error when no authentication data is present. Another test case might verify that a ",(0,s.kt)("inlineCode",{parentName:"p"},"PATCH")," request to the ",(0,s.kt)("inlineCode",{parentName:"p"},"/posts/:post_id/contribution")," endpoint correctly updates the corresponding contribution when the ",(0,s.kt)("inlineCode",{parentName:"p"},"payload")," includes a set of new tags."),(0,s.kt)("p",null,"Good test cases are small, self-contained, and independent. They should follow the ",(0,s.kt)("inlineCode",{parentName:"p"},"Arrange-Act-Assert")," pattern., which divides each test case into 3 phases:"),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("strong",{parentName:"li"},"Arrange:")," Set up all necessary inputs and preconditions."),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("strong",{parentName:"li"},"Act:")," Run the code under test."),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("strong",{parentName:"li"},"Assert:")," That the result of the test is as expected.")),(0,s.kt)("p",null,"Example:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},'test("Returns data for the logged in user", async () => {\n  // ARRANGE: Set the logged in user\n  setLoggedInUser("logged_in_user_id");\n\n  // ACT: Call the user data endpoint\n  const response = await request(server.app).get("/@me");\n\n  // ASSERT: Ensure that the user data received is as expected\n  expect(response.status).toBe(200);\n  expect(response.body).toEqual({\n    avatar_url: "/user_avatar.png",\n    username: "user_name",\n  });\n});\n')),(0,s.kt)("h3",{id:"mocking"},"Mocking"),(0,s.kt)("p",null,"Software might sometimes rely on external, complex services or library methods that are not suited for a testing environment (which might, for example, lack network connectivity or filesystem access). Rather than rely on these libraries or services, tests use ",(0,s.kt)("em",{parentName:"p"},"mock objects"),", fake versions of these services and libraries that stand in for the real ones."),(0,s.kt)("p",null,"Because ",(0,s.kt)("inlineCode",{parentName:"p"},"mocks")," are fake objects with no implementations, tests might need to define (if necessary) values returned by calls to mocked objects. If needed, tests can also make assertions on how the system under test interacted with the mocks, ensuring, for example, that certain methods have been called with the right parameters."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},'  test("returns cached data for logged in user", async function () {\n    setLoggedInUser("logged_in_user_id");\n    const cachedData = JSON.stringify({\n      avatar_url: "/this_was_cached.png",\n      username: "the_cached_username",\n    });\n    // When the cache "hget" method is called, the mock will give back the fake cached data\n    mocked(cache().hget).mockResolvedValueOnce(cachedData));\n\n    const res = await request(server.app).get("/@me");\n\n    expect(res.status).toBe(200);\n    // Make sure that the returned result is equal to the fake cached data.\n    // Note that if the cache were not called the result would be different\n    expect(res.body).toEqual(cachedData);\n\n    // Ensure that the cache "hget" method has been called once with the right parameters\n    expect(cache().hget).toBeCalledTimes(1);\n    expect(cache().hget).toBeCalledWith(CacheKeys.USER, "logged_in_user_id");\n')),(0,s.kt)("p",null,(0,s.kt)("inlineCode",{parentName:"p"},"Mocks")," used in BobaBackend's testing include the ",(0,s.kt)("inlineCode",{parentName:"p"},"cache"),", network requests (i.e. the ",(0,s.kt)("inlineCode",{parentName:"p"},"axios")," library), and the authentication service."),(0,s.kt)("h2",{id:"testing-bobabackends-api-routes"},"Testing BobaBackend's API Routes"),(0,s.kt)("p",null,"TODO"))}p.isMDXComponent=!0}}]);