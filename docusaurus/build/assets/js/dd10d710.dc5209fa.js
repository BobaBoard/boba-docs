"use strict";(self.webpackChunkbobadocs=self.webpackChunkbobadocs||[]).push([[8927],{5318:(e,t,n)=>{n.d(t,{Zo:()=>l,kt:()=>m});var o=n(7378);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=o.createContext({}),d=function(e){var t=o.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},l=function(e){var t=d(e.components);return o.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,p=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),u=d(n),m=a,h=u["".concat(p,".").concat(m)]||u[m]||c[m]||r;return n?o.createElement(h,i(i({ref:t},l),{},{components:n})):o.createElement(h,i({ref:t},l))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=u;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var d=2;d<r;d++)i[d]=n[d];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},9024:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>c,frontMatter:()=>r,metadata:()=>s,toc:()=>d});var o=n(5773),a=(n(7378),n(5318));const r={sidebar_position:2},i="How to work with endpoints",s={unversionedId:"engineering/boba-backend/APIs/creating-endpoints",id:"engineering/boba-backend/APIs/creating-endpoints",title:"How to work with endpoints",description:"An API endpoint is a URL clients can request to execute operations. Following REST principles, BobaBoard's server endpoints are grouped by the type of resource they refer to (e.g. boards, threads, users). Their naming and structure, which reflects their external URL, should follow the principles defined in our API guidelines.",source:"@site/docs/engineering/boba-backend/APIs/creating-endpoints.md",sourceDirName:"engineering/boba-backend/APIs",slug:"/engineering/boba-backend/APIs/creating-endpoints",permalink:"/docs/engineering/boba-backend/APIs/creating-endpoints",draft:!1,editUrl:"https://github.com/essential-randomness/bobadocs/edit/main/docs/engineering/boba-backend/APIs/creating-endpoints.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"engineering",previous:{title:"Introduction to APIs",permalink:"/docs/engineering/boba-backend/APIs/intro"},next:{title:"How to test endpoints",permalink:"/docs/engineering/boba-backend/APIs/testing-endpoints"}},p={},d=[{value:"Routes and endpoint structure",id:"structure",level:2},{value:"Adding a new endpoint",id:"adding-a-new-endpoint",level:2},{value:"Routes structure",id:"routes-structure",level:3},{value:"Creating a new top-level route",id:"top-level-route",level:3},{value:"Documenting endpoints",id:"documentation",level:2},{value:"Endpoint Documentation",id:"endpoint-documentation",level:3},{value:"Documenting components",id:"documenting-components",level:3},{value:"Adding examples",id:"adding-examples",level:3}],l={toc:d};function c(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,o.Z)({},l,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"how-to-work-with-endpoints"},"How to work with endpoints"),(0,a.kt)("p",null,"An API ",(0,a.kt)("inlineCode",{parentName:"p"},"endpoint")," is a URL clients can request to execute operations. Following REST principles, BobaBoard's server endpoints are grouped by the type of resource they refer to (e.g. boards, threads, users). Their naming and structure, which reflects their external URL, should follow the principles defined in our ",(0,a.kt)("a",{parentName:"p",href:"API-guidelines"},"API guidelines"),"."),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"The same endpoint can be called with different HTTP methods, each of which corresponds (when defined) to a different operation on the associated resources."),(0,a.kt)("p",{parentName:"admonition"},"You can learn more in our ",(0,a.kt)("a",{parentName:"p",href:"/docs/engineering/boba-backend/APIs/API-guidelines"},"intro to APIs"),".")),(0,a.kt)("h2",{id:"structure"},"Routes and endpoint structure"),(0,a.kt)("p",null,"Each subfolder in the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/BobaBoard/boba-backend/tree/master/server"},(0,a.kt)("inlineCode",{parentName:"a"},"server/")," directory")," defines the endpoints associated with the corresponding resource (e.g. boards, threads, users). For example, files in the ",(0,a.kt)("inlineCode",{parentName:"p"},"server/boards/")," directory define the endpoints at the ",(0,a.kt)("inlineCode",{parentName:"p"},"[server_adress]/boards/*")," URLs. In Express, the server framework BobaBoard uses, endpoints are defined through ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Learn/Server-side/Express_Nodejs/routes#routes_primer"},"Routes"),"."),(0,a.kt)("p",null,"Each subfolder in the ",(0,a.kt)("inlineCode",{parentName:"p"},"server/")," directory contains at least the following files:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"A ",(0,a.kt)("inlineCode",{parentName:"li"},"routes.ts")," file, which exports an instance of ",(0,a.kt)("a",{parentName:"li",href:"https://expressjs.com/en/api.html#express.router"},(0,a.kt)("inlineCode",{parentName:"a"},"Express.Router")," ")," and defines the subroutes of the endpoint. This file also contains the ",(0,a.kt)("a",{parentName:"li",href:"#documentation"},"documentation")," of each subroute in its own JSDoc."),(0,a.kt)("li",{parentName:"ul"},"A ",(0,a.kt)("inlineCode",{parentName:"li"},"queries.ts")," file, which contains methods acting as an interface between the route-handling code and the database."),(0,a.kt)("li",{parentName:"ul"},"A ",(0,a.kt)("inlineCode",{parentName:"li"},"sql/")," folder, containing the definition of the SQL queries used by ",(0,a.kt)("inlineCode",{parentName:"li"},"queries.ts"),"."),(0,a.kt)("li",{parentName:"ul"},"A ",(0,a.kt)("inlineCode",{parentName:"li"},"tests/")," folder, containing tests for the routes and queries. You can read more about defining tests in our ",(0,a.kt)("a",{parentName:"li",href:"/docs/engineering/boba-backend/APIs/testing-endpoints"},"testing endpoints guide"),"."),(0,a.kt)("li",{parentName:"ul"},"A ",(0,a.kt)("inlineCode",{parentName:"li"},"examples/")," folder (optional), containing examples used within our REST API documentation (see the ",(0,a.kt)("a",{parentName:"li",href:"#adding-examples"},"adding examples")," section)")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"server/all-routes.ts")," file associates the routers exported by the ",(0,a.kt)("inlineCode",{parentName:"p"},"routes.ts")," files with the corresponding root paths."),(0,a.kt)("h2",{id:"adding-a-new-endpoint"},"Adding a new endpoint"),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"A more general explanation of Express routing is available ",(0,a.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Learn/Server-side/Express_Nodejs/routes#routes_primer"},"on MDN"),".")),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Locate the ",(0,a.kt)("inlineCode",{parentName:"p"},"routes.ts")," file corresponding to the resource you want to add an endpoint to. It will be contained within the ",(0,a.kt)("inlineCode",{parentName:"p"},"server/[resource_name]")," directory."),(0,a.kt)("admonition",{parentName:"li",type:"note"},(0,a.kt)("p",{parentName:"admonition"},"If you're adding a new top-level route, follow the instruction in the ",(0,a.kt)("a",{parentName:"p",href:"#top-level-route"},"creating a new top-level route")," section."))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Decide which HTTP Method (",(0,a.kt)("inlineCode",{parentName:"p"},"GET"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"POST"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"PATCH"),", etc.) your endpoint will use. The ",(0,a.kt)("a",{parentName:"p",href:"/docs/engineering/boba-backend/APIs/intro#api-example"},"REST API example")," includes examples of different methods and their semantic. You can also consult the ",(0,a.kt)("a",{parentName:"p",href:"https://opensource.zalando.com/restful-api-guidelines/#148"},"Zalando API guidelines")," for an in-depth explanation.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Add the endpoint to your chosen ",(0,a.kt)("inlineCode",{parentName:"p"},"routes.ts")," file by calling the corresponding method on the ",(0,a.kt)("inlineCode",{parentName:"p"},"router")," variable. You can find the documentation for Express Router on the ",(0,a.kt)("a",{parentName:"p",href:"https://expressjs.com/en/api.html#router.METHOD"},"Express documentation website"),"."))),(0,a.kt)("h3",{id:"routes-structure"},"Routes structure"),(0,a.kt)("p",null,"Each route follows the same general structure:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'router.HTTP_METHOD("relative/path/to/route/", [middlewares], [routeHandler]);\n')),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"An express middleware is a function that runs before ",(0,a.kt)("inlineCode",{parentName:"p"},"routeHandler")," is executed. You can read more about middlewares on the ",(0,a.kt)("a",{parentName:"p",href:"https://expressjs.com/en/guide/using-middleware.html"},"Express documentation website"),".")),(0,a.kt)("p",null,"For example, the following code, contained within the ",(0,a.kt)("inlineCode",{parentName:"p"},"server/posts/routes.ts")," file, defines the ",(0,a.kt)("inlineCode",{parentName:"p"},"/posts/:post_id/comment")," endpoint:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'/**\n * Documentation goes here\n */\nrouter.post("/:post_id/comment", ensureLoggedIn, async (req, res) => {\n    // The post_id variable will contain the id of the post the endpoint corresponds to\n    const { post_id } = req.params;\n    // The contents variable is extracted from the body of the request\n    const { contents } = req.body;\n\n    // ...\n    // Route logic\n    // ...\n\n    // Send data to the client within a successful response (HTTP Status 200)\n    res.status(200).json({ /* data */ })\n}\n')),(0,a.kt)("admonition",{type:"warning"},(0,a.kt)("p",{parentName:"admonition"},"Each endpoint should be documented and tested.")),(0,a.kt)("h3",{id:"top-level-route"},"Creating a new top-level route"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Create the corresponding folders and files as defined in the ",(0,a.kt)("a",{parentName:"p",href:"#structure"},"structure")," section. Don't forget to export an ",(0,a.kt)("a",{parentName:"p",href:"https://expressjs.com/en/api.html#express.router"},(0,a.kt)("inlineCode",{parentName:"a"},"Express.Router"))," object from ",(0,a.kt)("inlineCode",{parentName:"p"},"routes.ts"),". Here is a minimal example:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'import express from "express";\nconst router = express.Router();\n\nrouter.get("/", async (req, res) => {\n  res.status(200).json({ message: "Hello world" });\n});\n\nexport default router;\n'))),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Add the new router to ",(0,a.kt)("inlineCode",{parentName:"p"},"server/all-routes.ts"),". Example:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'import NewEndpointRoute from "./new_endpoint/routes";\n\nconst ROUTES: { [key: string]: Router } = {\n  // ...other routes\n  new_endpoint: NewEndpointRoute,\n};\n')))),(0,a.kt)("h2",{id:"documentation"},"Documenting endpoints"),(0,a.kt)("p",null,"We use the ",(0,a.kt)("a",{parentName:"p",href:"https://spec.openapis.org/oas/latest.html"},"OpenAPI 3.1")," spec to document API endpoints."),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"You can learn more about the libraries used and the setup ",(0,a.kt)("a",{parentName:"p",href:"https://dev.to/essentialrandom/documenting-express-rest-apis-with-openapi-and-jsdoc-m68"},"on this dev.to article"),".")),(0,a.kt)("p",null,"OpenAPI specifications are best learned by looking at existing documentation. If you need more exhaustive explanations (or have doubts), documentation is available ",(0,a.kt)("a",{parentName:"p",href:"https://swagger.io/docs/specification/paths-and-operations/"},"on the OpenAPI website"),"."),(0,a.kt)("p",null,"During development, you can preview your documentation by opening ",(0,a.kt)("inlineCode",{parentName:"p"},"http://localhost:4200/api-docs/")," in your browser. Oce the updated server is deployed to production, the documentation will be automatically available ",(0,a.kt)("a",{parentName:"p",href:"/docs/engineering/rest-api/"},"on this same website"),"."),(0,a.kt)("p",null,"The generated OpenAPI JSON spec is available at the ",(0,a.kt)("inlineCode",{parentName:"p"},"/open-api.json")," endpoint."),(0,a.kt)("h3",{id:"endpoint-documentation"},"Endpoint Documentation"),(0,a.kt)("p",null,"The documentation of each endpoint is co-located with the endpoint declaration in the",(0,a.kt)("inlineCode",{parentName:"p"},"routes.ts")," file, using the ",(0,a.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/swagger-jsdoc"},(0,a.kt)("inlineCode",{parentName:"a"},"swagger-jsdoc"))," library. Note that the documentation uses ",(0,a.kt)("a",{parentName:"p",href:"https://learnxinyminutes.com/docs/yaml/"},(0,a.kt)("inlineCode",{parentName:"a"},"YAML syntax")),"."),(0,a.kt)("p",null,"Quick inline explanations of the various parts of the documentation can be found looking for ",(0,a.kt)("inlineCode",{parentName:"p"},"<- ALL CAPS EXPLANATION")," within the following example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'/**\n * @openapi\n * /posts/{post_id}/comment: <- THE ENDPOINT WE\'RE DOCUMENTING\n *   post: <- THE HTTP METHOD ASSOCIATED WITH THE ENDPOINT\n *     summary: Add comments to a contribution, optionally nested under another comment.\n *     description: Creates a comment nested under the contribution with id {post_id}.\n *     tags: <- USED BY THE DOCUMENTATION TO GROUP ENDPOINTS\n *       - /posts/\n *     security:\n *       - firebase: [] <- INDICATES THAT THE ENDPOINT NEEDS AUTHENTICATION\n *     parameters:\n *       - name: post_id <- DEFINES THE SEMANTIC OF THE post_id PARAMETER\n *         in: path <- THE post_id PARAMETER IS WITHIN THE ENDPOINT URL\n *         description: The uuid of the contribution to reply to.\n *         required: true\n *         schema:\n *           type: string\n *           format: uuid\n *     requestBody: <- DEFINES THE CONTENT OF THE BODY IN POST REQUESTS\n *       description: The details of the comment to post.\n *       required: true\n *       content:\n *         application/json:\n *           schema:\n *             allOf: <- ALL THE FOLLOWING PROPERTIES ARE REQUIRED\n *               - type: object\n *                 properties:\n *                   contents: <- AN ARRAY OF ITEMS SHAPED LIKE THE Comment COMPONENT\n *                     type: array\n *                     items:\n *                       $ref: "#/components/schemas/Comment"\n *                   reply_to_comment_id: <- THE ID OF THE COMMENT THIS COMMENT IS IN REPLY TO\n *                     nullable: true\n *                     type: string\n *                     format: uuid\n *               - $ref: "#/components/schemas/IdentityParams" <- ALL THE PROPERTIES WITHIN THE IdentityParams COMPONENT\n *     responses:\n *       401:\n *         description: User was not found in request that requires authentication.\n *       403:\n *         description: User is not authorized to perform the action.\n *       200:\n *         description: The comments were successfully created.\n *         content:\n *           application/json:\n *             schema:\n *               type: object\n *               properties:\n *                 comments: <- A SUCCESSFUL RESPONSE WILL BE AN OBJECT WITH A comments FIELD SHAPED LIKE AN ARRAY OF Comment\n *                   description: Finalized details of the comments just posted.\n *                   type: array\n *                   items:\n *                     $ref: "#/components/schemas/Comment"\n */\nrouter.post("/:post_id/comment", ensureLoggedIn, async (req, res) => {\n    // Route code\n}\n')),(0,a.kt)("p",null,"As you can see in the example, components are referred to through the ",(0,a.kt)("inlineCode",{parentName:"p"},"$ref")," attribute. You can learn more about components in the ",(0,a.kt)("a",{parentName:"p",href:"#documenting-components"},"documenting components")," section."),(0,a.kt)("h3",{id:"documenting-components"},"Documenting components"),(0,a.kt)("p",null,"Components are reusable definitions of either data models (e.g. ",(0,a.kt)("inlineCode",{parentName:"p"},"Contribution"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"Comment"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"Board"),"), parameters, or other data types. You can find their documentation on the ",(0,a.kt)("a",{parentName:"p",href:"https://swagger.io/docs/specification/components/"},"OpenAPI Specs website"),". Components are added to the documentation through the ",(0,a.kt)("a",{parentName:"p",href:"https://swagger.io/docs/specification/using-ref/"},"$ref shortcut"),"."),(0,a.kt)("p",null,"Components are located within the ",(0,a.kt)("inlineCode",{parentName:"p"},"/types/open-api")," folder, and defined through ",(0,a.kt)("a",{parentName:"p",href:"https://learnxinyminutes.com/docs/yaml/"},(0,a.kt)("inlineCode",{parentName:"a"},"YAML files")),"."),(0,a.kt)("p",null,"For example, this component defines a reusable data model for identity. It can be found under ",(0,a.kt)("inlineCode",{parentName:"p"},"/types/open-api/identity.yaml"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"components:\n  schemas:\n    Identity:\n      type: object\n      properties:\n        name:\n          type: string\n        avatar:\n          type: string\n          format: uri\n      required:\n        - name\n        - avatar\n    SecretIdentity:\n      type: object\n      properties:\n        name:\n          type: string\n        avatar:\n          type: string\n          format: uri\n        color:\n          type: string\n        accessory:\n          type: string\n          format: uri\n      required:\n        - name\n        - avatar\n")),(0,a.kt)("p",null,"Other documentation can refer to these components by using the ",(0,a.kt)("inlineCode",{parentName:"p"},'$ref: "#/components/schemas/Identity"')," and ",(0,a.kt)("inlineCode",{parentName:"p"},'$ref: "#/components/schemas/SecretIdentity"')," constructs."),(0,a.kt)("h3",{id:"adding-examples"},"Adding examples"),(0,a.kt)("admonition",{type:"TODO"},(0,a.kt)("p",{parentName:"admonition"},"This section is incomplete. Ask Ms. Boba to fill it out!")))}c.isMDXComponent=!0}}]);